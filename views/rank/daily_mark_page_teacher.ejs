<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Mark</title>


    <%- include("../component/metadata.html") %>

</head>

<body onload="pageLoadingTop()">

    <%- include("../component/user-header-nav.html") %>
        <%- include("../component/teacher-offcanvas-nav.html") %>

            <div class="p-2 mt-5 row">

                <center class="mt-3">
                    <h6>Daily mark system</h6>
                    <code class="fw-semibold" id="syncTime"><%=today%></code>
                </center>


                <div class="col-10 col-md-6 mt-2 m-auto">
                    <input class=" form-dev p-2 ps-3 border-0" style="background-color: rgba(211, 207, 207, 0.26);"
                        type="search" name="" placeholder="Search in page" id="search">

                </div>

            </div>


            <div class="row mt-1 mbx p-2 shadowx">

                <div class="col-12 col-md-8 m-auto p-2" id="syncSystemApp">


                    <% for(let index=0; index<info.length; index++) {%>

                        <ul class="list-group findcard mt-2" id="list">
                            <li class="list-group-item list-group-item-light shadow">
                                <img src="/assets/images/student/resized/<%=info[index].avatar%>" height="30px" class=" rounded"
                                    width="40px" alt="">

                                <span class="  bg-light text-muted">(<%=info[index].class%> - <%=info[index].section%> - <%=info[index].roll%>)
                                </span>
                                <span class="  bg-light text-dark">
                                   <%=info[index].name%> 
                                </span>
                                <hr> <span class=" btn-lg  badge bg-light text-dark">Behavior</span> <br>
                              
                                <div class=" btn-group btn-group-sm ">

                                    <button onclick="post_mark_def('behavior', 'b1', 'rmb', -1.666, '<%=info[index].student_uuid%>',  '<%=info[index].student_id%>', '<%=info[index].name%>', '<%=info[index].roll%>', '<%=info[index].avatar%>')" class="b1_<%=info[index].student_uuid%> rmb_<%=info[index].student_uuid%> btn btn-danger fs-3 bg-light text-danger ">&#10030;</button>

                                    <button onclick="post_mark_def('behavior', 'b2', 'rmb', 0.666, '<%=info[index].student_uuid%>',  '<%=info[index].student_id%>', '<%=info[index].name%>', '<%=info[index].roll%>', '<%=info[index].avatar%>')" class="b2_<%=info[index].student_uuid%> rmb_<%=info[index].student_uuid%> btn btn-primary fs-3 bg-light text-primary">&#10030;&#10030;</button>
                                   
                                    <button onclick="post_mark_def('behavior', 'b3', 'rmb', 1.666, '<%=info[index].student_uuid%>',  '<%=info[index].student_id%>', '<%=info[index].name%>', '<%=info[index].roll%>', '<%=info[index].avatar%>')" class="b3_<%=info[index].student_uuid%> rmb_<%=info[index].student_uuid%> btn btn-success fs-3 bg-light text-success ">&#10030;&#10030;&#10030;</button>

                                </div>

                                <hr> <span class=" btn-lg  badge bg-light text-dark">Uniform</span> <br>
                            
                                <div class=" btn-group btn-group-sm ">

                                    <button onclick="post_mark_def('uniform', 'u1', 'rmu', -1.555, '<%=info[index].student_uuid%>',  '<%=info[index].student_id%>',  '<%=info[index].name%>', '<%=info[index].roll%>', '<%=info[index].avatar%>',)" class="u1_<%=info[index].student_uuid%> rmu_<%=info[index].student_uuid%> btn btn-danger fs-3 bg-light  text-danger ">&#10026;</button>
                                   
                                    <button onclick="post_mark_def('uniform', 'u2', 'rmu', 0.555, '<%=info[index].student_uuid%>',  '<%=info[index].student_id%>',  '<%=info[index].name%>', '<%=info[index].roll%>', '<%=info[index].avatar%>',)"  class="u2_<%=info[index].student_uuid%> rmu_<%=info[index].student_uuid%> btn btn-primary fs-3 bg-light text-primary">&#10026;&#10026;</button>
                                 
                                    <button onclick="post_mark_def('uniform', 'u3', 'rmu', 1.555, '<%=info[index].student_uuid%>',  '<%=info[index].student_id%>', '<%=info[index].name%>', '<%=info[index].roll%>', '<%=info[index].avatar%>',)"  class="u3_<%=info[index].student_uuid%> rmu_<%=info[index].student_uuid%> btn btn-success fs-3 bg-light text-success ">&#10026;&#10026;&#10026;</button>
                                </div>


                                <hr> <span class=" btn-lg  badge bg-light text-dark">Study</span> <br>
                          
                                <div class=" btn-group btn-group-sm ">

                                    <button onclick="post_mark_def('study', 's1', 'rms', -1.333, '<%=info[index].student_uuid%>',  '<%=info[index].student_id%>', '<%=info[index].name%>', '<%=info[index].roll%>', '<%=info[index].avatar%>',)" class="s1_<%=info[index].student_uuid%> rms_<%=info[index].student_uuid%> btn btn-danger fs-3 bg-light text-danger ">&#x2730;</button>

                                    <button onclick="post_mark_def('study', 's2', 'rms', 0.333,'<%=info[index].student_uuid%>',  '<%=info[index].student_id%>', '<%=info[index].name%>', '<%=info[index].roll%>', '<%=info[index].avatar%>',)" class="s2_<%=info[index].student_uuid%> rms_<%=info[index].student_uuid%> btn btn-primary fs-3 bg-light text-primary">&#x2730;&#x2730; </button>
                                 
                                    <button onclick="post_mark_def('study', 's3', 'rms', 1.333, '<%=info[index].student_uuid%>',  '<%=info[index].student_id%>', '<%=info[index].name%>', '<%=info[index].roll%>', '<%=info[index].avatar%>',)" class="s3_<%=info[index].student_uuid%> rms_<%=info[index].student_uuid%> btn btn-success fs-3  bg-light text-success ">&#x2730;&#x2730;&#x2730;</button>

                                </div>
                            </li>


                        </ul>

                        <% } %>

                </div>

                <div id="syncSystem" class="p-2 mt-5 mb-5"></div>

            </div>


           <%- include("../component/___node.html") %>


<script>
$(document).ready(function () {
$("#search").keyup(function () {
var value = $(this).val().toLowerCase();
$(".list-group").filter(function () {

$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
});
 });
 });

function checkout_class(){
  const class_name = `<%=class_name%>`;
  const section_name = `<%=section_name%>`;
  $.ajax({
    type: "POST",
    url: "/teacher/rank/mark/checkout/",
    data: {class_name, section_name},
    dataType: "JSON",
    success: function (res) {
      for (const index in res.info) {
        $(`.${res.info[index].checkout}`).addClass('disabled bg-dark');
      }

    }
  });
}
checkout_class()


const placeHolder = `
    <div class="row p-2" >
    <div class="col-10 col-md-6 mt-2 m-auto" >

    <div class="card" aria-hidden="true">
  <div class="card-body">
    <h5 class="card-title placeholder-glow">
      <span class="placeholder col-6"></span>
    </h5>
    <p class="card-text placeholder-glow">
      <span class="placeholder col-7"></span>
      <span class="placeholder col-4"></span>
      <span class="placeholder col-4"></span>
      <span class="placeholder col-6"></span>
      <span class="placeholder col-8"></span>
    </p>
    <a href="#" tabindex="-1" class="btn btn-primary disabled placeholder col-6"></a>
  </div>
</div>

</div>
</div>
      `
 
  const elem = document.getElementById('syncSystem');
  var pageNumber = 0;
  function syncStudent() {
    pageNumber++
    const class_name = `<%=class_name%>`;
    const section_name = `<%=section_name%>`;
    const offset = pageNumber;
    $.ajax({
      type: "POST",
      url: "/teacher/rank/mark/page/num",
      data: { class_name, section_name, offset },
      dataType: "JSON",
      beforeSend: () => {

        $('#syncSystem').html(placeHolder)
       
      },
      success: function (res) {
        if (res.data == false) {
          $('#syncSystem').html('')
        } else {
          $('#syncSystemApp').append(res.htmldata)
          checkout_class()
        }

      }
    });
  }

  new IntersectionObserver((event) => {

    if (event[0].isIntersecting == true) {

      syncStudent()

    }
    else { }

  }, { threshold: 0.8 }).observe(elem);



function post_mark_def(column, cls, rm, mark, sid, student_id, name, roll, avatar){
   const class_name= '<%=class_name%>';
   const section_name= '<%=section_name%>';
   console.log(cls, sid);
   $.ajax({
    type: "post",
    url: "/teacher/rank/mark/post/",
    data: {class_name, section_name, column, mark, cls, sid, student_id, name, roll, avatar},
    dataType: "JSON",
    beforeSend: ()=>{
    },
    success: function (res) {
    if(res.msg==true){
     $(`.${rm}_${sid}`).removeClass('disabled bg-dark')
     $(`.${cls}_${sid}`).addClass('disabled bg-dark')
    }

    }
   });
}

 </script>

</body>


</html>